



<!DOCTYPE html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
        <meta name="description" content="This hands-on workshop is where you will learn about a number of AWS services involved with threat detection and response as we walk through real-world threat scenarios. Learn about the threat detection capabilities of Amazon GuardDuty, Amazon Macie and AWS Security Hub and the available response options. For each hands-on scenario, we review methods to detect and respond to threats using the following services: AWS CloudTrail, Amazon VPC flow logs, Amazon CloudWatch Events, Amazon Macie, AWS Lambda, Amazon Inspector, Amazon GuardDuty and Amazon Security Hub.">
      
      
        <link rel="canonical" href="https://scaling-threat-detection.awssecworkshops.jp/01-environment-setup/">
      
      
        <meta name="author" content="aws-security-workshops@amazon.com">
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../assets/images/aws-favicon.ico">
      <meta name="generator" content="mkdocs-1.0.4, mkdocs-material-3.1.0">
    
    
      
        <title>モジュール 1: 環境構築と設定 - AWS 環境における脅威検知と対応</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/application.11e41852.css">
      
      
    
    
      <script src="../assets/javascripts/modernizr.20ef595d.js"></script>
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../assets/fonts/material-icons.css">
    
    
      <link rel="stylesheet" href="../stylesheets/custom.css">
    
    
  </head>
  
    <body dir="ltr">
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448"
    viewBox="0 0 416 448" id="__github">
  <path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19-18.125
        8.5-18.125-8.5-10.75-19-3.125-20.5 3.125-20.5 10.75-19 18.125-8.5
        18.125 8.5 10.75 19 3.125 20.5zM320 304q0 10-3.125 20.5t-10.75
        19-18.125 8.5-18.125-8.5-10.75-19-3.125-20.5 3.125-20.5 10.75-19
        18.125-8.5 18.125 8.5 10.75 19 3.125 20.5zM360
        304q0-30-17.25-51t-46.75-21q-10.25 0-48.75 5.25-17.75 2.75-39.25
        2.75t-39.25-2.75q-38-5.25-48.75-5.25-29.5 0-46.75 21t-17.25 51q0 22 8
        38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0
        37.25-1.75t35-7.375 30.5-15 20.25-25.75 8-38.375zM416 260q0 51.75-15.25
        82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5-41.75
        1.125q-19.5 0-35.5-0.75t-36.875-3.125-38.125-7.5-34.25-12.875-30.25-20.25-21.5-28.75q-15.5-30.75-15.5-82.75
        0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25
        30.875q36.75-8.75 77.25-8.75 37 0 70 8 26.25-20.5
        46.75-30.25t47.25-9.75q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34
        99.5z" />
</svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#1" tabindex="1" class="md-skip">
        Skip to content
      </a>
    
    
      <!--
  Copyright (c) 2016-2018 Martin Donath <martin.donath@squidfunk.com>
  Permission is hereby granted, free of charge, to any person obtaining a copy
  of this software and associated documentation files (the "Software"), to
  deal in the Software without restriction, including without limitation the
  rights to use, copy, modify, merge, publish, distribute, sublicense, and/or
  sell copies of the Software, and to permit persons to whom the Software is
  furnished to do so, subject to the following conditions:
  The above copyright notice and this permission notice shall be included in
  all copies or substantial portions of the Software.
  THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
  IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
  FITNESS FOR A PARTICULAR PURPOSE AND NON-INFRINGEMENT. IN NO EVENT SHALL THE
  AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
  LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
  FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS
  IN THE SOFTWARE.
-->

<!-- Application header -->
<header class="md-header" data-md-component="header">

    <!-- Top-level navigation -->
    <nav class="md-header-nav md-grid">
      <div class="md-flex">
  
        <!-- Link to home -->
        <div class="md-flex__cell md-flex__cell--shrink">
          <a href="https://aws.amazon.com/"
              title="Amazon Web Services"
              class="md-header-nav__button md-logo">
            
              <img src="../assets/images/aws_smile_logo.png" width="40" height="24" />
            
          </a>
        </div>
  
        <!-- Button to toggle drawer -->
        <div class="md-flex__cell md-flex__cell--shrink">
          <label class="md-icon md-icon--menu md-header-nav__button"
              for="__drawer"></label>
        </div>
  
        <!-- Header title -->
        <div class="md-flex__cell md-flex__cell--stretch">
          <div class="md-flex__ellipsis md-header-nav__title"
              data-md-component="title">
            
              
                <span class="md-header-nav__topic">
                  AWS 環境における脅威検知と対応
                </span>
                <span class="md-header-nav__topic">
                  モジュール 1: 環境構築と設定
                </span>
              
            
          </div>
        </div>
        
        
        <!-- Button to open search dialogue -->
        <!--
        <div class="md-flex__cell md-flex__cell--shrink">
          
            
              <label class="md-icon md-icon--search md-header-nav__button"
                  for="__search"></label>
  
              
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
            
          
        </div>

         -->
         
         <div class="md-flex__cell md-flex__cell--shrink">
            <div class="md-flex__ellipsis md-header-nav__lang">
                <div>
                    <button onclick="window.location.href = 'https://awssecworkshops.com/';" class="md-lang-dropbtn fa fa-home"></button>
                </div>
            </div>
        </div>
  
        <!-- Repository containing source -->
        
          <div class="md-flex__cell md-flex__cell--shrink">
            <div class="md-header-nav__source">
              


  


  <a href="https://github.com/aws-samples/aws-scaling-threat-detection-workshop-jp/" title="Go to repository" class="md-source" data-md-source="github">
    
      <div class="md-source__icon">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <use xlink:href="#__github" width="24" height="24"></use>
        </svg>
      </div>
    
    <div class="md-source__repository">
      aws-samples/aws-scaling-threat-detection-workshop-jp
    </div>
  </a>

            </div>
          </div>
        
      </div>
    </nav>
  </header>
    
    <div class="md-container">
      
        
      
      
        

<nav class="md-tabs" data-md-component="tabs">
  <div class="md-tabs__inner md-grid">
    <ul class="md-tabs__list">
      
        
  <li class="md-tabs__item">
    
      <a href=".." title="Overview" class="md-tabs__link md-tabs__link--active">
        Overview
      </a>
    
  </li>

      
        
      
        
      
        
      
        
      
        
      
        
      
    </ul>
  </div>
</nav>
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <!--
  Copyright (c) 2016-2019 Martin Donath <martin.donath@squidfunk.com>
  Permission is hereby granted, free of charge, to any person obtaining a copy
  of this software and associated documentation files (the "Software"), to
  deal in the Software without restriction, including without limitation the
  rights to use, copy, modify, merge, publish, distribute, sublicense, and/or
  sell copies of the Software, and to permit persons to whom the Software is
  furnished to do so, subject to the following conditions:
  The above copyright notice and this permission notice shall be included in
  all copies or substantial portions of the Software.
  THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
  IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
  FITNESS FOR A PARTICULAR PURPOSE AND NON-INFRINGEMENT. IN NO EVENT SHALL THE
  AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
  LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
  FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS
  IN THE SOFTWARE.
-->

<!-- Main navigation -->
<nav class="md-nav md-nav--primary" data-md-level="0">

  <!-- Site title -->
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="https://scaling-threat-detection.awssecworkshops.jp/"
        title="AWS 環境における脅威検知と対応" class="md-nav__button md-logo">
      
        <img src="../assets/images/aws_smile_logo.png" width="48" height="48" />
      
    </a>
    Scaling threat detection
  </label>

  <!-- Repository containing source -->
  
    <div class="md-nav__source">
      


  


  <a href="https://github.com/aws-samples/aws-scaling-threat-detection-workshop-jp/" title="Go to repository" class="md-source" data-md-source="github">
    
      <div class="md-source__icon">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <use xlink:href="#__github" width="24" height="24"></use>
        </svg>
      </div>
    
    <div class="md-source__repository">
      aws-samples/aws-scaling-threat-detection-workshop-jp
    </div>
  </a>

    </div>
  

  <!-- Render item list -->
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href=".." title="Overview" class="md-nav__link">
      Overview
    </a>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        モジュール 1: 環境構築と設定
      </label>
    
    <a href="./" title="モジュール 1: 環境構築と設定" class="md-nav__link md-nav__link--active">
      モジュール 1: 環境構築と設定
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#aws-cloudformation" title="AWS CloudFormation テンプレートのデプロイ" class="md-nav__link">
    AWS CloudFormation テンプレートのデプロイ
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#amazon-cloudwatch" title="Amazon CloudWatch イベントルールおよび自動応答の設定" class="md-nav__link">
    Amazon CloudWatch イベントルールおよび自動応答の設定
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#amazon-guardduty" title="Amazon GuardDuty の有効化" class="md-nav__link">
    Amazon GuardDuty の有効化
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#enable-amazon-macie" title="Enable Amazon Macie" class="md-nav__link">
    Enable Amazon Macie
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#setup-amazon-macie-for-data-discovery-classification" title="Setup Amazon Macie for data discovery &amp; classification" class="md-nav__link">
    Setup Amazon Macie for data discovery &amp; classification
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#enable-aws-security-hub" title="Enable AWS Security Hub" class="md-nav__link">
    Enable AWS Security Hub
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#architecture-overview" title="Architecture overview" class="md-nav__link">
    Architecture overview
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../02-attack-simulation/" title="Module 2: Attack Simulation" class="md-nav__link">
      Module 2: Attack Simulation
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../03-detection-and-remediation/" title="Module 3: Detect & Respond" class="md-nav__link">
      Module 3: Detect & Respond
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../04-review-and-discussion/" title="Module 4: Discussion" class="md-nav__link">
      Module 4: Discussion
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../contribute/" title="Contributing" class="md-nav__link">
      Contributing
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../license/" title="License" class="md-nav__link">
      License
    </a>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#aws-cloudformation" title="AWS CloudFormation テンプレートのデプロイ" class="md-nav__link">
    AWS CloudFormation テンプレートのデプロイ
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#amazon-cloudwatch" title="Amazon CloudWatch イベントルールおよび自動応答の設定" class="md-nav__link">
    Amazon CloudWatch イベントルールおよび自動応答の設定
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#amazon-guardduty" title="Amazon GuardDuty の有効化" class="md-nav__link">
    Amazon GuardDuty の有効化
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#enable-amazon-macie" title="Enable Amazon Macie" class="md-nav__link">
    Enable Amazon Macie
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#setup-amazon-macie-for-data-discovery-classification" title="Setup Amazon Macie for data discovery &amp; classification" class="md-nav__link">
    Setup Amazon Macie for data discovery &amp; classification
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#enable-aws-security-hub" title="Enable AWS Security Hub" class="md-nav__link">
    Enable AWS Security Hub
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#architecture-overview" title="Architecture overview" class="md-nav__link">
    Architecture overview
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/aws-samples/aws-scaling-threat-detection-workshop-jp/edit/master/docs/01-environment-setup.md" title="Edit this page" class="md-icon md-content__icon">&#xE3C9;</a>
                
                
                <h1 id="1">モジュール 1: 環境構築と設定</h1>
<p>最初のモジュールでは、検知と対応の統制の初期設定をします。2 つの CloudFormation テンプレートのうち、1つ目を実行して、これらの Control のいくつかの作成を自動化し、残りのものを手動で設定します。</p>
<h2 id="aws-cloudformation">AWS CloudFormation テンプレートのデプロイ</h2>
<p>シナリオを開始して環境を設定するには、モジュール 1 の CloudFormation テンプレートを実行する必要があります。</p>
<div class="admonition info">
<p class="admonition-title">Before you deploy the CloudFormation template feel free to view it <a href="https://github.com/aws-samples/aws-scaling-threat-detection-workshop/blob/master/templates/01-environment-setup.yml" target="_blank">here</a href>.</p>
</div>
<table>
<thead>
<tr>
<th>リージョン</th>
<th>デプロイ</th>
</tr>
</thead>
<tbody>
<tr>
<td>US West 2 (Oregon)</td>
<td><a href="https://console.aws.amazon.com/cloudformation/home?region=us-west-2#/stacks/new?stackName=ThreatDetectionWksp-Env-Setup&templateURL=https://s3-us-west-2.amazonaws.com/sa-security-specialist-workshops-us-west-2/threat-detect-workshop/staging/01-environment-setup.yml" target="_blank"><img alt="Deploy Module 1 in us-west-2" src="../images/deploy-to-aws.png" /></a></td>
</tr>
</tbody>
</table>
<ol>
<li>
<p>上の <strong>Deploy to AWS (AWS へのデプロイ)</strong> ボタンをクリックします。これにより、テンプレートを実行するコンソールに自動的に移動します。</p>
</li>
<li>
<p><strong>Specify Details (詳細の指定)</strong> セクションで、以下に示す必要なパラメータを入力します。</p>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td>Stack name</td>
<td>ThreatDetectionWksp-Env-Setup</td>
</tr>
<tr>
<td>Email Address</td>
<td>A <strong><em>valid</em></strong> email address</td>
</tr>
</tbody>
</table>
</li>
<li>
<p>パラメータを入力したら、<strong>Next (次)</strong> をクリックし、もう一度 <strong>Next (次)</strong> をクリックします (このページの設定はデフォルトのままにします)。</p>
</li>
<li>
<p>最後に、テンプレートによって IAM ロールが作成されることに確認し、<strong>Create (作成)</strong> をクリックします。</p>
</li>
</ol>
<p><img alt="IAM Capabilities" src="../images/iam-capabilities.png" /></p>
<p>これによって CloudFormation コンソールに戻ります。ページを更新して、作成を開始するスタックを確認することができます。次に進む前に、スタックが以下に示すように <strong>CREATE_COMPLETE</strong> ステータスであることを確認します。</p>
<p><img alt="Stack Complete" src="../images/01-stack-complete.png" /></p>
<p>SNS から、サブスクリプションを確認するように依頼するメールが届きます。ワークショップ中に AWS のサービスからメールアラートを受信できるように、<strong>サブスクリプションを確認します</strong>。</p>
<div class="admonition info">
<p class="admonition-title">アラートメールの送信元は <a href="&#109;&#97;&#105;&#108;&#116;&#111;&#58;&#110;&#111;&#45;&#114;&#101;&#112;&#108;&#121;&#64;&#115;&#110;&#115;&#46;&#97;&#109;&#97;&#122;&#111;&#110;&#97;&#119;&#115;&#46;&#99;&#111;&#109;">&#110;&#111;&#45;&#114;&#101;&#112;&#108;&#121;&#64;&#115;&#110;&#115;&#46;&#97;&#109;&#97;&#122;&#111;&#110;&#97;&#119;&#115;&#46;&#99;&#111;&#109;</a> になります。受信できない場合は、ご利用のメール環境でフォルダ振り分けがされていたり、SPAM判定をされていたりしないかご確認ください。</p>
</div>
<h2 id="amazon-cloudwatch">Amazon CloudWatch イベントルールおよび自動応答の設定</h2>
<p>先ほど実行した CloudFormation テンプレートによって、アラートおよび応答のための 3 つの <a href="https://docs.aws.amazon.com/AmazonCloudWatch/latest/events/WhatIsCloudWatchEvents.html" target="_blank">CloudWatch イベントルール</a> が作成されました。以下の手順で最終的なルールを作成します。この後、メール通知を受け取り、脅威に対応するために AWS Lambda 関数をトリガーするための必要なすべてのルールが設定されます。</p>
<p>以下は、コンソールを通じてこのルールを作成する手順ですが、<a href="http://docs.aws.amazon.com/guardduty/latest/ug/guardduty_findings_cloudwatch.html" target="_blank">Amazon GuardDuty ドキュメント</a>を確認することで、プログラムでルールを実行する方法についても詳しく知ることができます</p>
<ol>
<li><a href="https://us-west-2.console.aws.amazon.com/cloudwatch/home?region=us-west-2" target="_blank">CloudWatch コンソール</a> (us-west-2) を開きます。</li>
<li>
<p>左のナビゲーションペインで、<strong>Events (イベント)</strong> の下の <strong>Rules (ルール)</strong> をクリックします。</p>
<div class="admonition question">
<p class="admonition-title">現在のルールは何を実行するように設定されていますか?</p>
</div>
</li>
<li>
<p><strong>Create Rule (ルールの作成)</strong> をクリックします。</p>
</li>
<li>
<p><strong>Event Pattern (イベントパターン)</strong> の下で、<strong>Build event pattern to match events by service (サービス別のイベントに一致するイベントパターンの構築)</strong> をクリックし、ドロップダウンの <strong>Custom event pattern (カスタムイベントパターン)</strong> を選択します。以下のカスタムイベントパターンを貼り付けます。</p>
</li>
</ol>
<div class="codehilite"><pre><span></span><span class="p">{</span>
  <span class="nt">&quot;source&quot;</span><span class="p">:</span> <span class="p">[</span>
    <span class="s2">&quot;aws.guardduty&quot;</span>
  <span class="p">],</span>
  <span class="nt">&quot;detail&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="p">[</span>
      <span class="s2">&quot;UnauthorizedAccess:EC2/MaliciousIPCaller.Custom&quot;</span>
    <span class="p">]</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>


<p>ターゲットについては、<strong>Add Target (ターゲットの追加)</strong> をクリックし、<strong>Lambda Function (Lambda 関数)</strong> を選択してから <strong>threat-detection-wksp-remediation-nacl</strong> を選択します。<strong>Configure details (詳細の構成)</strong> をクリックします。</p>
<ol>
<li><strong>Configure rule details (ルールの詳細の構成)</strong> 画面で、<strong>Name (名前)</strong> および <strong>Description (説明)</strong> を入力します (以下を参照)。<ul>
<li>Name (名前): <strong>threat-detection-wksp-guardduty-finding-ec2-maliciousip</strong></li>
<li>Description (説明): <strong>GuardDuty の検出結果: UnauthorizedAccess:EC2/MaliciousIPCaller.Custom</strong></li>
</ul>
</li>
<li><strong>Create rule (ルールの作成)</strong> をクリックします。</li>
<li>
<p><strong>オプション:</strong> Lambda関数が何をしているのかを見てみましょう。Open the <a href="https://us-west-2.console.aws.amazon.com/lambda/home?region=us-west-2" target="_blank">Lambda コンソール</a>を開きます. <strong>threat-detection-wksp-remediation-nacl</strong> という名前の関数をクリックします。</p>
<div class="admonition question">
<p class="admonition-title">この関数は何を行う関数ですか?</p>
</div>
<div class="admonition question">
<p class="admonition-title">Threat-detection-wksp-remediation-inspector 関数は何を行いますか?</p>
</div>
</li>
</ol>
<h2 id="amazon-guardduty">Amazon GuardDuty の有効化</h2>
<p>The next step is to enable Amazon GuardDuty, which will continuously monitor your environment for malicious or unauthorized behavior.</p>
<ol>
<li>
<p>Go to the <a href="https://us-west-2.console.aws.amazon.com/guardduty/home?region=us-west-2" target="_blank">Amazon GuardDuty</a> console (us-west-2).</p>
</li>
<li>
<p>Click the <strong>Get Started</strong> button.</p>
</li>
<li>
<p>On the next screen click the <strong>Enable GuardDuty</strong> button.</p>
</li>
</ol>
<p>GuardDuty is now enabled and continuously monitoring your CloudTrail logs, VPC flow logs, and DNS Query logs for threats in your environment.</p>
<h2 id="enable-amazon-macie">Enable Amazon Macie</h2>
<p>Since you plan on storing sensitive data in S3, let’s quickly enable Amazon Macie.  Macie is a security service that will continuously monitor data access activity for anomalies and generate alerts when it detects risk of unauthorized access or inadvertent data leaks.</p>
<ol>
<li>
<p>Go to the <a href="https://us-west-2.redirection.macie.aws.amazon.com/" target="_blank">Amazon Macie</a> console (us-west-2).</p>
</li>
<li>
<p>Click <strong>Get Started</strong>.</p>
</li>
<li>
<p>Macie will create a service-linked role when you enable it. If you would like to see the permissions that the role will have you can click the <strong>View service role permissions</strong>.</p>
</li>
<li>
<p>Click <strong>Enable Macie</strong>.</p>
</li>
</ol>
<h2 id="setup-amazon-macie-for-data-discovery-classification">Setup Amazon Macie for data discovery &amp; classification</h2>
<p>Macie is also used for automatically discovering and classifying sensitive data.  Now that Macie is enabled, setup an integration to classify data in your S3 bucket.</p>
<ol>
<li>
<p>In the Amazon Macie console click on <strong>Integrations</strong> on the left navigation.</p>
</li>
<li>
<p>Find your AWS account ID (there should be only one) and click <strong>Select</strong> </p>
</li>
<li>
<p>Click <strong>Add</strong> then on the next screen click the check box next to the S3 bucket that ends with <strong>“-data”</strong>. Click <strong>Add</strong></p>
</li>
<li>
<p>Leave the options here at the default, click <strong>Review</strong>.</p>
</li>
<li>
<p>On the next screen click <strong>Start Classification</strong>. </p>
</li>
<li>
<p>Finally click <strong>Done</strong>. Macie is now enabled and has begun to discover, classify and protect your data.</p>
</li>
</ol>
<h2 id="enable-aws-security-hub">Enable AWS Security Hub</h2>
<p>Now that all of your detective controls have been configured you need to enable <a href="https://aws.amazon.com/security-hub/" target="_blank">AWS Security Hub</a>, which will provide you with a comprehensive view of the security and compliance of your AWS environment.</p>
<ol>
<li>
<p>Go to the <a href="https://us-west-2.console.aws.amazon.com/securityhub/home?region=us-west-2#" target="_blank">AWS Security Hub</a> console.</p>
</li>
<li>
<p>Click the <strong>Enable Security Hub</strong> button.</p>
</li>
<li>
<p>On the next screen click the <strong>Enable AWS Security Hub</strong> button.</p>
</li>
</ol>
<p>AWS Security Hub is now enabled and will begin collecting and aggregating findings from the security services we have enabled so far.</p>
<h2 id="architecture-overview">Architecture overview</h2>
<p>Your environment is now configured and ready for operations.  Below is a diagram to depict the detective controls you now have in place.</p>
<p><img alt="Detective Controls" src="../images/01-diagram-module1.png" /></p>
<p>After you have successfully setup your environment, you can proceed to the next module.</p>
                
                  
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href=".." title="Overview" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Overview
              </span>
            </div>
          </a>
        
        
          <a href="../02-attack-simulation/" title="Module 2: Attack Simulation" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Module 2: Attack Simulation
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            &copy; 2019, Amazon Web Services, Inc. or its affiliates. All rights reserved.
          </div>
        
        powered by
        <a href="https://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
        
  <div class="md-footer-social">
    <link rel="stylesheet" href="../assets/fonts/font-awesome.css">
    
      <a href="https://awssecworkshops.com" class="md-footer-social__link fa fa-home"></a>
    
      <a href="https://aws.amazon.com/security/" class="md-footer-social__link fa fa-shield"></a>
    
      <a href="https://twitter.com/awssecurityinfo?lang=en" class="md-footer-social__link fa fa-twitter"></a>
    
      <a href="https://aws.amazon.com/blogs/security/" class="md-footer-social__link fa fa-rss"></a>
    
  </div>

      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../assets/javascripts/application.9e1f3b71.js"></script>
      
      <script>app.initialize({version:"1.0.4",url:{base:".."}})</script>
      
    
    
      
    
  </body>
</html>